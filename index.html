<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HardHatHub | Canada's Industrial Pipeline</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .job-card { transition: all 0.2s ease; border: 1px solid #e2e8f0; border-radius: 1.5rem; background: white; padding: 1.5rem; }
        .job-card:hover { transform: translateY(-3px); border-color: #facc15; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .ad-card { background: #fffbeb; border: 2px dashed #fcd34d; border-radius: 1.5rem; padding: 1.5rem; }
        
        /* Modal Overlay Styles */
        #login-modal { display: none; }
        #login-modal.active { display: flex; }
    </style>
</head>
<body class="bg-[#F8FAFC] text-slate-900 min-h-screen flex flex-col">

    <nav class="bg-white border-b border-slate-200 py-4 sticky top-0 z-[50]">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
            <img src="https://174hz.github.io/hardhathub/logo.png" alt="HardHatHub" class="h-10 cursor-pointer" onclick="window.location.reload()">
            <div class="flex items-center gap-4">
                <button id="auth-btn" onclick="openModal()" class="text-xs font-bold uppercase tracking-widest hover:text-yellow-600">Login</button>
                <button class="bg-yellow-500 text-black px-5 py-2.5 rounded-lg font-black text-xs uppercase tracking-widest hover:bg-black hover:text-white transition-all">Post Ad</button>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto px-4 py-12 w-full">
        <h2 class="text-5xl font-extrabold uppercase mb-10 tracking-tighter">Industrial <span class="text-yellow-500">Pipeline</span></h2>
        <div id="job-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </main>

    <div id="login-modal" class="fixed inset-0 z-[100] items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-400 hover:text-black font-bold">✕</button>
            
            <div id="step-1">
                <h3 class="text-2xl font-black uppercase mb-2">Enter the Hub</h3>
                <p class="text-sm text-slate-500 mb-6 font-bold uppercase tracking-tight">Access the Canada Job Pipeline</p>
                <input type="email" id="login-email" placeholder="work-email@address.com" class="w-full p-4 bg-slate-100 rounded-xl mb-4 border-2 border-transparent focus:border-yellow-500 outline-none font-bold">
                <button onclick="sendCode()" class="w-full bg-black text-white py-4 rounded-xl font-black uppercase text-xs tracking-widest hover:bg-yellow-500 hover:text-black transition-all">Send Magic Link Code</button>
            </div>

            <div id="step-2" class="hidden text-center">
                <h3 class="text-2xl font-black uppercase mb-2 text-yellow-600">Check Email</h3>
                <p class="text-sm text-slate-500 mb-6 font-bold uppercase">Enter the code sent to your inbox</p>
                <input type="text" id="login-token" placeholder="000000" class="w-full p-4 bg-slate-100 rounded-xl mb-4 border-2 border-transparent focus:border-yellow-500 outline-none font-black text-center text-2xl tracking-[0.5em]">
                <button onclick="verifyCode()" class="w-full bg-black text-white py-4 rounded-xl font-black uppercase text-xs tracking-widest hover:bg-yellow-600 transition-all">Verify & Enter</button>
                <button onclick="resetModal()" class="mt-4 text-[10px] font-bold uppercase text-slate-400 hover:text-black">Try different email</button>
            </div>
        </div>
    </div>

    <footer class="bg-slate-900 text-white/50 py-12 mt-20 border-t-4 border-yellow-500 text-center">
        <p class="text-[10px] font-black uppercase tracking-widest">© 2026 HARDHAT HUB CANADA</p>
    </footer>

    <script>
        const SB_URL = "https://oakwbsqdcljxckfmjyva.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ha3dic3FkY2xqeGNrZm1qeXZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NTI3NDcsImV4cCI6MjA4NDMyODc0N30.T_S_AeKeeM13cNPnggh26xj9jGNgCLocB5n84pjDqfI";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        // Modal Controls
        function openModal() { document.getElementById('login-modal').classList.add('active'); }
        function closeModal() { document.getElementById('login-modal').classList.remove('active'); resetModal(); }
        function resetModal() {
            document.getElementById('step-1').classList.remove('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('login-email').value = '';
            document.getElementById('login-token').value = '';
        }

        // Auth Logic
        async function sendCode() {
            const email = document.getElementById('login-email').value;
            if(!email) return alert("Enter email");
            
            const { error } = await _supabase.auth.signInWithOtp({ email });
            if (error) return alert(error.message);

            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
        }

        async function verifyCode() {
            const email = document.getElementById('login-email').value;
            const token = document.getElementById('login-token').value;
            
            const { error } = await _supabase.auth.verifyOtp({ email, token, type: 'magiclink' });
            if (error) return alert("Invalid Code. Try again.");

            alert("Login Success!");
            location.reload();
        }

        // Job Fetching
        async function fetchJobs() {
            const { data } = await _supabase.from('jobs').select('*').order('created_at', { ascending: false });
            if (data) {
                const grid = document.getElementById('job-grid');
                grid.innerHTML = data.map(job => `
                    <div class="job-card">
                        <h3 class="text-xl font-black uppercase mb-1">${job.title}</h3>
                        <p class="text-xs font-bold text-yellow-600 uppercase mb-3">${job.company} • ${job.location || 'Ontario'}</p>
                        <p class="text-[11px] text-slate-500 font-medium mb-6 line-clamp-3">${job.description || 'Verified industrial shift listing.'}</p>
                        <a href="${job.apply_link || job.link}" target="_blank" class="block w-full text-center bg-slate-900 text-white py-3 rounded-lg font-black uppercase text-[10px] tracking-widest hover:bg-yellow-500 hover:text-black transition-all">View Details</a>
                    </div>
                `).join('');
            }
        }

        // Sync Login State
        _supabase.auth.onAuthStateChange((event, session) => {
            const btn = document.getElementById('auth-btn');
            if (session) {
                btn.innerText = 'Logout';
                btn.onclick = async () => { await _supabase.auth.signOut(); location.reload(); };
            }
        });

        window.onload = fetchJobs;
    </script>
</body>
</html>
